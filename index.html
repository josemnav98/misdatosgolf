<script>
    const API_KEY = 'e72e887fcbmsh533532df62ebd23p15b710jsnecfeebbc7925';
    const DRIVE_CSV_URL = 'https://docs.google.com/spreadsheets/d/1gndtK_orjzYzqxWPlcIId_xrmyomAMka/export?format=csv';

    // Funci贸n para manejar el Ranking desde Drive (Fija)
    async function fetchOWGR() {
        try {
            const response = await fetch(DRIVE_CSV_URL);
            const text = await response.text();
            const rows = text.split('\n').map(row => row.split(','));
            let html = '';
            for (let i = 1; i <= 10; i++) {
                const row = rows[i];
                if (row && row.length >= 5) {
                    html += `<tr class="hover:bg-slate-50">
                        <td class="px-6 py-4 font-bold text-slate-400">${row[0].replace(/"/g, '')}</td>
                        <td class="py-4 font-semibold text-slate-900">${row[4].replace(/"/g, '')}</td>
                        <td class="px-6 py-4 text-right font-mono text-indigo-600 text-xs">${row[5].replace(/"/g, '')}</td>
                    </tr>`;
                }
            }
            document.getElementById('owgr-table-body').innerHTML = html;
            document.getElementById('empty-state').style.display = 'none';
        } catch (e) { console.error("Drive Error:", e); }
    }

    // Funci贸n para los calendarios (Mejorada)
    async function fetchTour(orgId, containerId) {
        const list = document.getElementById(containerId);
        const year = 2024; // Probamos con 2024 primero porque muchas APIs tardan en subir 2026

        try {
            const options = {
                method: 'GET',
                headers: {
                    'x-rapidapi-key': API_KEY,
                    'x-rapidapi-host': 'live-golf-data.p.rapidapi.com'
                }
            };

            // Intentamos la petici贸n
            const res = await fetch(`https://live-golf-data.p.rapidapi.com/schedule?orgId=${orgId}&year=${year}`, options);
            
            if (res.status === 401 || res.status === 403) {
                list.innerHTML = '<p class="py-10 text-[10px] text-red-400 text-center uppercase tracking-widest">Error de Llave API (401/403)</p>';
                return;
            }

            const data = await res.json();
            
            if (!data || data.length === 0) {
                list.innerHTML = '<p class="py-10 text-[10px] text-slate-400 text-center uppercase tracking-widest">No hay eventos para ' + year + '</p>';
                return;
            }

            list.innerHTML = data.slice(0, 6).map(ev => `
                <div class="tour-card bg-white border border-slate-200 p-5 rounded-2xl flex justify-between items-center shadow-sm">
                    <div>
                        <span class="text-[9px] font-bold text-indigo-500 uppercase tracking-tighter">${ev.startDate || 'TBD'}</span>
                        <h4 class="text-sm font-bold text-slate-800 mt-1">${ev.tournamentName}</h4>
                        <p class="text-[10px] text-slate-400 mt-1">${ev.city || ''}</p>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 text-slate-200"></i>
                </div>
            `).join('');
        } catch (e) {
            console.error("API Error:", e);
            list.innerHTML = '<p class="py-10 text-[10px] text-slate-400 text-center">Error de conexi贸n con la API</p>';
        }
        lucide.createIcons();
    }

    function switchTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-link').forEach(l => {
            l.classList.remove('active-tab'); l.classList.add('text-slate-400');
        });
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active-tab');
        evt.currentTarget.classList.remove('text-slate-400');
    }

    window.onload = () => {
        fetchOWGR();
        fetchTour(1, 'pga-list');
        fetchTour(2, 'dpw-list');
        lucide.createIcons();
    };
</script>
